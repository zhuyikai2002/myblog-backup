---
title: "VPS 重装后的抢救行动：从 404 到一键部署的进化"
date: "2026-01-28 19:30:00"
tags: [运维, Nginx, VPS, GitHub Actions, CI/CD, 自动化, Hexo]
categories: [技术, 运维]
description: VPS 重装系统后，网站变成了 404。在 AI 的协助下，我不仅修复了问题，还顺手给整个部署流程来了一次"大升级"——现在 VPS 重装后只需一条命令就能恢复全部配置。
---

> **摘要**：今天打开 qzkj.ltd，迎接我的是一个冰冷的 404。VPS 之前重装了 Debian 12，主页文件全丢了。本以为是个简单的文件恢复，结果在 Cursor 的帮助下，我不仅重建了终端模拟器主页，还顺手把整个仓库结构优化了一遍，甚至写了一个 VPS 一键初始化脚本。从"救火"到"防火"，今天的折腾让我的博客部署流程进化到了新的高度。

---

**时间：** 2026.01.28  
**关键词：** VPS 重装 / 404 排查 / Nginx 配置 / 一键部署 / CI/CD 优化  
**状态：** 从手忙脚乱到胸有成竹

## 🔥 1) 开局：一个让人心凉的 404

今天想看看自己的博客，结果打开 `qzkj.ltd`，迎面就是一个 404。

我愣了几秒钟。`/blog` 页面正常，`/about` 页面正常，但**根路径直接 404**。

想起来之前 VPS 重装过 Debian 12，当时从 VPS 导出了 Nginx 配置备份。我把配置文件丢给 Cursor，让它帮我分析问题。

## 🔍 2) 诊断：丢失的不是配置，是主页文件

Cursor 很快定位到了问题。从我的 `myblog.conf` 配置来看：

```nginx
location = / {
    root /var/www/homepage;
    try_files /index.html =404;
}
```

根路径被指向了 `/var/www/homepage/index.html`，但这个文件在 VPS 重装后**丢失了**。

而 `/blog` 正常是因为它走的是另一条路径：

```nginx
location ^~ /blog/ {
    alias /var/www/myblog/public/;
    ...
}
```

原来我之前做了一个**终端模拟器风格的主页**，可以通过 `cd /blog`、`cd /about` 这样的命令跳转。现在主页文件没了，自然就 404 了。

## 🛠️ 3) 重建：不只是恢复，而是升级

既然要重建主页，不如顺手把整个项目优化一下。

### 终端模拟器主页

Cursor 帮我重新创建了一个终端模拟器主页，支持的命令包括：
- `cd /blog` - 跳转博客
- `cd /about` - 跳转关于
- `cd /lab` - 跳转实验室
- `ls`、`help`、`clear` 等常用命令
- 方向键浏览命令历史
- Tab 键自动补全

界面是深色的 CRT 终端风格，带扫描线效果和光标闪烁动画，看起来很极客。

### 仓库结构优化

趁热打铁，我让 Cursor 帮我重构了整个 `myblog-backup` 仓库：

**新增的文件：**
- `scripts/vps-init.sh` - VPS 一键初始化脚本 ⭐
- `nginx/myblog.conf` - Nginx 配置模板
- `README.md` - 完整的项目文档

**删除的冗余文件：**
- `BLOG_PUBLISH_GUIDE.md`
- `CI-CD-配置说明.md`
- `QUICK_PUBLISH.md`
- `test.txt`

**修复的问题：**
- `deploy.sh` 里的路径从 `/var/www/html/blog/` 修正为 `/var/www/myblog/public/`

## 🚀 4) 进化：一键初始化脚本

这次折腾最大的收获是写了一个 **VPS 一键初始化脚本**。

以后 VPS 重装系统，只需要一条命令：

```bash
curl -fsSL https://raw.githubusercontent.com/zhuyikai2002/myblog-backup/main/scripts/vps-init.sh | sudo bash
```

脚本会自动完成：
- 安装 Nginx 和 rsync
- 创建 `/var/www/myblog/public/` 和 `/var/www/homepage/` 目录
- 下载并配置 Nginx
- 部署终端模拟器主页
- 配置 SSL 证书（可选）
- 开放防火墙端口

再也不用手动一步步配置了。

## 🐛 5) 踩坑：GitHub Actions 部署失败

改完代码 `git push` 后，GitHub Actions 报错了。

**第一个错误：Exit code 255**

这是 SSH 连接失败。因为 VPS 重装后，旧的 SSH 公钥丢失了，需要重新添加：

```bash
ssh-copy-id -i ~/.ssh/id_ed25519.pub root@VPS_IP
```

**第二个错误：Exit code 12**

SSH 通了，但 rsync 报错。原因是 VPS 上没装 rsync，目标目录也不存在：

```bash
apt install -y rsync
mkdir -p /var/www/myblog/public /var/www/homepage
```

**第三个问题：GitHub Pages 排版乱了**

因为 `_config.yml` 里配置的是 `root: /blog/`（给 VPS 用的），但 GitHub Pages 的路径是 `/myblog-backup/`。

解决方案是修改 GitHub Actions workflow，先构建 VPS 版本部署到 VPS，再修改配置构建 GitHub Pages 版本：

```yaml
# 先部署 VPS（root: /blog/）
- name: Build for VPS
  run: npm run build
# 部署到 VPS...

# 再部署 GitHub Pages（root: /myblog-backup/）
- name: Rebuild for GitHub Pages
  run: |
    sed -i 's|root: /blog/|root: /myblog-backup/|g' _config.yml
    npx hexo clean && npx hexo generate
```

这样两边的排版都正常了。

## ✅ 6) 总结：从救火到防火

今天本来只是想修个 404，结果顺手做了这些事：

| 任务 | 状态 |
|------|------|
| 重建终端模拟器主页 | ✅ |
| 优化仓库结构 | ✅ |
| 创建 VPS 一键初始化脚本 | ✅ |
| 修复 GitHub Actions SSH 问题 | ✅ |
| 修复 GitHub Pages 路径问题 | ✅ |
| 更新 README 文档 | ✅ |

以前每次 VPS 出问题，都是临时抱佛脚、手动修复。现在有了一键初始化脚本，下次重装系统只需要：

1. 在 VPS 上运行初始化脚本
2. 本地 `git push`
3. 等 GitHub Actions 自动部署

**从"救火"到"防火"**，这才是正确的运维思路。

## 🔮 7) 下一步

- [ ] 把 Nginx 配置也纳入版本控制，实现真正的"基础设施即代码"
- [ ] 给初始化脚本加上更多自定义选项
- [ ] 研究一下容器化部署（Docker）

今天的折腾虽然花了不少时间，但换来的是一套更健壮、更自动化的部署流程。

值了。
