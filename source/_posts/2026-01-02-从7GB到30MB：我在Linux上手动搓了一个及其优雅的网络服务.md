---
title: 从 7GB 到 30MB：我在 Linux 上手动搓了一个极其优雅的网络服务
date: 2026-01-02 14:30:00
tags: [Linux, Mihomo, Systemd, 优化, 随笔]
categories: 嵌入式折腾日记
description: 面对占用 7GB 内存的 Clash Verge，我转身拥抱“无头模式”。手动配置 Systemd + Mihomo + Web UI，将内存占用从 7GB 压缩到 30MB，体验了 Linux 命令行的优雅。
---

# 别了，内存黑洞

昨天（1月1日）其实过得挺悠哉。
STM32 的呼吸灯搞定后，整个人松弛了下来。晚上我哥搞了顿火锅，叫了几个朋友来家里聚餐，推杯换盏喝了点小酒，也就没怎么碰电脑。

但当我再次打开电脑准备干活（其实是打游戏）时，我发现我的 Linux 卡得不行。打开任务管理器一看，血压上来了：

**那个图形化的代理软件（Clash Verge），竟然吃掉了我 7GB 的内存！**

作为一个刚入门嵌入式、正在学习“抠内存”的人，看到这种资源浪费简直不能忍。原作者跑路留下的 WebView 内存泄漏 Bug，让这个软件在 Linux 上简直就是个毒瘤。

**不能忍，必须换。**

## 转身拥抱“无头模式”

既然 GUI 靠不住，那就回归 Linux 的本质——**命令行与服务**。

在老哥的建议和 AI 的辅助下，我决定抛弃一切花里胡哨的客户端，直接运行 **Mihomo (Clash Meta)** 核心，并把它做成系统服务。

这个过程并不顺利，中间踩了好几个坑：
1.  **僵尸进程**：旧的进程杀不干净，导致端口冲突，Systemd一直报错。
2.  **配置地狱**：DNS 校验逻辑报错，导致服务刚启动 25ms 就挂掉。
3.  **混合订阅**：我想同时保留我的私人 VPS 节点和机场的几十个订阅节点。

## 见证奇迹的时刻

经过一番 `killall`、修改 `config.yaml` 和 `systemd` 配置调试，终于，那个绿色的小圆点亮了。

```bash
Active: active (running) ...
Memory: 29.7M