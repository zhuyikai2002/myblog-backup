---
title: å‘Šåˆ«è‡ªè¨€è‡ªè¯­ï¼Œè®© STM32 å¬æ‡‚æˆ‘çš„è¯ (UARTä¸­æ–­å®æˆ˜)
date: 2026-01-07 22:30:00
tags: [STM32, UART, ä¸­æ–­, Linux, åµŒå…¥å¼, NVIC, ä¸²å£]
categories: [åµŒå…¥å¼æŠ˜è…¾æ—¥è®°]
description: ä¹‹å‰ç”¨ OpenOCD ç‚¹äº®äº†å‘¼å¸ç¯ï¼Œä»Šå¤©å†³å®šæ¢ä¸ªç©æ³•ï¼šç”¨ä¸²å£ (UART) è·Ÿæ¿å­èŠå¤©ã€‚ç›®æ ‡æ˜¯ç”µè„‘å‘é€æŒ‡ä»¤ '1' ç‚¹äº® LEDï¼Œå‘é€ '0' ç†„ç­ LEDã€‚æŠ›å¼ƒè½®è¯¢æ‹¥æŠ±ä¸­æ–­ï¼Œä½¿ç”¨ USB-TTL é…åˆ stm32flash è¿›è¡Œ ISP çƒ§å½•ï¼Œåœ¨ Linux ç»ˆç«¯ç”¨ picocom å……å½“ä¸²å£åŠ©æ‰‹ï¼Œè¸©äº†"æ‰‹æ»‘"ã€æ‹¬å·ç¼ºå¤±ã€å¼•è„šé…ç½®ç­‰å‘ï¼Œæœ€ç»ˆå®ç°ä¸­æ–­å›è°ƒæ§åˆ¶ LEDã€‚
---

> **æ‘˜è¦**ï¼šä¹‹å‰ç”¨ OpenOCD ç‚¹äº®äº†å‘¼å¸ç¯ï¼Œä»Šå¤©å†³å®šæ¢ä¸ªç©æ³•ï¼šç”¨ **ä¸²å£ (UART)** è·Ÿæ¿å­èŠå¤©ã€‚ç›®æ ‡æ˜¯ï¼šç”µè„‘å‘é€æŒ‡ä»¤ `'1'`ï¼Œç‚¹äº® LEDï¼›å‘é€ `'0'`ï¼Œç†„ç­ LEDã€‚æŠ›å¼ƒè½®è¯¢æ‹¥æŠ±ä¸­æ–­ï¼Œä½¿ç”¨ USB-TTL é…åˆ `stm32flash` å·¥å…·è¿›è¡Œ ISP çƒ§å½•ï¼Œåœ¨ Linux ç»ˆç«¯ç”¨ `picocom` å……å½“ä¸²å£åŠ©æ‰‹ï¼Œè¸©äº†"æ‰‹æ»‘"ã€æ‹¬å·ç¼ºå¤±ã€å¼•è„šé…ç½®ç­‰å‘ï¼Œæœ€ç»ˆå®ç°ä¸­æ–­å›è°ƒæ§åˆ¶ LEDã€‚

---

**æ—¶é—´ï¼š** 2026.01.07  
**ç¯å¢ƒï¼š** Ubuntu + VS Code + GCC + Makefile + stm32flash  
**ç¡¬ä»¶ï¼š** STM32F103C8T6 + USB-TTL (PA9/PA10)

## ğŸ“ ä»Šæ—¥ç›®æ ‡

ä¹‹å‰ç”¨ OpenOCD ç‚¹äº®äº†å‘¼å¸ç¯ï¼Œä»Šå¤©å†³å®šæ¢ä¸ªç©æ³•ï¼šç”¨ **ä¸²å£ (UART)** è·Ÿæ¿å­èŠå¤©ã€‚ç›®æ ‡æ˜¯ï¼šç”µè„‘å‘é€æŒ‡ä»¤ `'1'`ï¼Œç‚¹äº® LEDï¼›å‘é€ `'0'`ï¼Œç†„ç­ LEDã€‚

## ğŸ› ï¸ æŠ€æœ¯è¦ç‚¹

1. **æŠ›å¼ƒè½®è¯¢ï¼Œæ‹¥æŠ±ä¸­æ–­ï¼š** ä¸åœ¨ `while(1)` é‡Œå‚»ç­‰æ•°æ®ï¼Œè€Œæ˜¯å¼€å¯ `NVIC` ä¸­æ–­ã€‚
2. **å·¥å…·é“¾åˆ‡æ¢ï¼š** ä»Šå¤©æ²¡ç”¨ ST-Linkï¼Œæ”¹ç”¨ USB-TTLï¼Œé…åˆ `stm32flash` å·¥å…·è¿›è¡Œ ISP çƒ§å½•ã€‚
3. **è°ƒè¯•ç¥å™¨ï¼š** åœ¨ Linux ç»ˆç«¯ç”¨ `picocom` å……å½“ä¸²å£åŠ©æ‰‹ï¼Œæ¯” Windows ä¸‹çš„ç‚¹ç‚¹ç‚¹å¸…å¤šäº†ã€‚

## ğŸ’£ è¸©å‘ä¸å¡«å‘è®°å½• (Debug Log)

### 1. ç»å…¸çš„"æ‰‹æ»‘"ç°åœº

ç¼–è¯‘æŠ¥é”™ `implicit declaration`ï¼ŒæŸ¥äº†åŠå¤©å‘ç°æ‰‹å¿«æŠŠ `HAL_UART_Transmit` å†™æˆäº† `HAL_UARL_Transmit`ã€‚
*æ•™è®­ï¼šTab é”®è¡¥å…¨æ‰æ˜¯æ°¸è¿œçš„ç¥ï¼Œä¸è¦ç›²ç›®è‡ªä¿¡æ‰‹æ‰“ã€‚*

### 2. æ¶ˆå¤±çš„"ä¿„ç½—æ–¯å¥—å¨ƒ"æ‹¬å·

åœ¨æ¸…ç©º `while(1)` é‡Œçš„æ—§ä»£ç æ—¶ï¼Œä¸å°å¿ƒæŠŠ `main` å‡½æ•°çš„ç»“æŸå¤§æ‹¬å· `}` ä¹Ÿç»™åˆ äº†ã€‚å¯¼è‡´ `make` ç–¯ç‹‚æŠ¥é”™ `invalid storage class`ï¼Œä»¥ä¸ºæˆ‘åœ¨ `main` è‚šå­é‡Œå®šä¹‰äº†å…¶ä»–å‡½æ•°ã€‚
*è§£å†³ï¼šè¡¥ä¸Šä¸¤ä¸ª `}`ï¼Œä¸€ä¸ªç»™ `while`ï¼Œä¸€ä¸ªç»™ `main`ã€‚*

### 3. "æ˜™èŠ±ä¸€ç°"çš„ LED

ä»£ç çƒ§è¿›å»äº†ï¼Œä¸²å£ä¹Ÿèƒ½å›æ˜¾ "LED ON"ï¼Œä½†æ¿å­ä¸Šçš„ç¯åªæ˜¯**é—ªä¸€ä¸‹å°±ç­**ï¼Œæ­»æ´»ä¸å¸¸äº®ã€‚
*æ’æŸ¥ï¼š* å±…ç„¶æ˜¯å› ä¸ºåœ¨ CubeMX é‡Œåªé…äº†ä¸²å£ï¼Œ**å¿˜äº†æŠŠ PC13 å¼•è„šè®¾ä¸º GPIO_Output**ï¼
*åŸç†ï¼š* æ²¡è®¾è¾“å‡ºæ—¶å¼•è„šæ˜¯é«˜é˜»æ€ï¼ˆInputï¼‰ï¼Œæ ¹æœ¬æ²¡åŠ›æ°”æ‹‰ä½ç”µå¹³ç‚¹ç¯ã€‚æ”¹æˆ Output åï¼Œé—®é¢˜ç§’è§£ã€‚

## ğŸ’» æ ¸å¿ƒä»£ç  (Callback å›è°ƒ)

æŠŠé€»è¾‘å†™åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä¸»å¾ªç¯ç©ºè·‘ï¼Œè¿™æ‰æ˜¯åµŒå…¥å¼çš„"ä¼˜é›…"ï¼š

```c
// æ”¾åœ¨ main.c æœ€ä¸‹æ–¹
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
    if(huart->Instance == USART1)
    {
        if(rx_data == '1') {
            HAL_GPIO_WritePin(GPIOC, GPIO_PIN_13, GPIO_PIN_RESET); // äº®ç¯
            HAL_UART_Transmit(&huart1, (uint8_t*)"LED ON\r\n", 8, 100);
        }
        else if(rx_data == '0') {
            HAL_GPIO_WritePin(GPIOC, GPIO_PIN_13, GPIO_PIN_SET);   // ç­ç¯
            HAL_UART_Transmit(&huart1, (uint8_t*)"LED OFF\r\n", 9, 100);
        }
        // å…³é”®ï¼šé‡æ–°å¼€å¯ç›‘å¬ï¼Œä¸ç„¶åªèƒ½å¬ä¸€æ¬¡
        HAL_UART_Receive_IT(&huart1, &rx_data, 1);
    }
}
```

## ğŸ‰ æœ€ç»ˆæˆæœ

åœ¨ç»ˆç«¯æ•²ä¸‹ï¼š
```bash
sudo picocom -b 115200 /dev/ttyUSB0
```

æŒ‰ä¸‹é”®ç›˜ `1`ï¼Œæ¿å­ç¯äº®ï¼›æŒ‰ä¸‹ `0`ï¼Œæ¿å­ç¯ç­ã€‚

**æ„Ÿå—ï¼š** ç°åœ¨çš„æˆ‘å·²ç»å®Œå…¨ä¸éœ€è¦æ‰“å¼€ Windows å’Œ Keil äº†ã€‚åœ¨ Linux ä¸‹æ•² `make` å’Œ `sudo stm32flash` çš„æ„Ÿè§‰ï¼ŒçœŸçš„æœ‰ç‚¹ä¸Šå¤´ï¼æ˜å¤©è¯•è¯•æŠŠä¹‹å‰çš„ PWM ç»“åˆè¿›æ¥ï¼Œåšä¸ªå¯è°ƒäº®åº¦çš„ç¯ï¼
