---
title: å‘Šåˆ«è‡ªè¨€è‡ªè¯­ï¼Œè®© STM32 å¬æ‡‚æˆ‘çš„è¯ (UARTä¸­æ–­å®æˆ˜)
date: 2026-01-07 22:30:00
tags: [STM32, UART, ä¸­æ–­, Linux, åµŒå…¥å¼, NVIC, ä¸²å£, VS Code]
categories: [åµŒå…¥å¼æŠ˜è…¾æ—¥è®°]
description: ä¹‹å‰ç”¨ OpenOCD ç‚¹äº®äº†å‘¼å¸ç¯ï¼Œä»Šå¤©å†³å®šæ¢ä¸ªç©æ³•ï¼šç”¨ä¸²å£ (UART) è·Ÿæ¿å­èŠå¤©ã€‚ä½œä¸º Linux åµŒå…¥å¼åŸç”Ÿç©å®¶ï¼Œä½“éªŒäº† VS Code å¼ºå¤§çš„ Tab è¡¥å…¨åŠŸèƒ½ï¼ŒéšåæŠ›å¼ƒè½®è¯¢æ‹¥æŠ±ä¸­æ–­ã€‚ä½¿ç”¨ USB-TTL é…åˆ stm32flash è¿›è¡Œ ISP çƒ§å½•ï¼Œåœ¨ Linux ç»ˆç«¯ç”¨ picocom å……å½“ä¸²å£åŠ©æ‰‹ï¼Œè¸©äº†"æ‰‹æ»‘"ã€æ‹¬å·ç¼ºå¤±ã€å¼•è„šé…ç½®ç­‰å‘ï¼Œæœ€ç»ˆå®ç°ä¸­æ–­å›è°ƒæ§åˆ¶ LEDã€‚
---

> **æ‘˜è¦**ï¼šä¹‹å‰ç”¨ OpenOCD ç‚¹äº®äº†å‘¼å¸ç¯ï¼Œä»Šå¤©å†³å®šæ¢ä¸ªç©æ³•ï¼šç”¨ **ä¸²å£ (UART)** è·Ÿæ¿å­èŠå¤©ã€‚ä½œä¸º Linux åµŒå…¥å¼åŸç”Ÿç©å®¶ï¼Œä½“éªŒäº† VS Code å¼ºå¤§çš„ Tab è¡¥å…¨åŠŸèƒ½ï¼ŒéšåæŠ›å¼ƒè½®è¯¢æ‹¥æŠ±ä¸­æ–­ã€‚ä½¿ç”¨ USB-TTL é…åˆ `stm32flash` å·¥å…·è¿›è¡Œ ISP çƒ§å½•ï¼Œåœ¨ Linux ç»ˆç«¯ç”¨ `picocom` å……å½“ä¸²å£åŠ©æ‰‹ï¼Œè¸©äº†"æ‰‹æ»‘"ã€æ‹¬å·ç¼ºå¤±ã€å¼•è„šé…ç½®ç­‰å‘ï¼Œæœ€ç»ˆå®ç°ä¸­æ–­å›è°ƒæ§åˆ¶ LEDã€‚

---

**æ—¶é—´ï¼š** 2026.01.07  
**ç¯å¢ƒï¼š** Ubuntu + VS Code + GCC + Makefile + stm32flash  
**ç¡¬ä»¶ï¼š** STM32F103C8T6 + USB-TTL (PA9/PA10)

## ğŸ“ ä»Šæ—¥ç›®æ ‡

ä¹‹å‰ç”¨ OpenOCD ç‚¹äº®äº†å‘¼å¸ç¯ï¼Œä»Šå¤©å†³å®šæ¢ä¸ªç©æ³•ï¼šç”¨ **ä¸²å£ (UART)** è·Ÿæ¿å­èŠå¤©ã€‚

1. å…ˆè·‘é€šæœ€ç®€å•çš„ **Hello World**ï¼ˆè½®è¯¢å‘é€ï¼‰ã€‚
2. è¿›é˜¶å®ç° **å‘½ä»¤æ§åˆ¶**ï¼ˆä¸­æ–­æ¥æ”¶ï¼‰ï¼šç”µè„‘å‘é€æŒ‡ä»¤ `'1'`ï¼Œç‚¹äº® LEDï¼›å‘é€ `'0'`ï¼Œç†„ç­ LEDã€‚

## ğŸš€ åˆä½“éªŒï¼šVS Code çš„"é­”æ³•" (Tab é”®æ²»å¥½äº†æˆ‘çš„æ‹¼å†™å›°éš¾ç—‡)

ä½œä¸ºç›´æ¥åœ¨ Linux ç¯å¢ƒä¸‹èµ·æ­¥çš„æ–°æ‰‹ï¼Œæˆ‘æ²¡æœ‰ç»å†è¿‡ä¼ ç»Ÿ Keil å¼€å‘ç¯å¢ƒçš„â€æŠ˜ç£¨"ï¼Œç›´æ¥äº«å—äº† VS Code å¸¦æ¥çš„ç°ä»£å¼€å‘ä½“éªŒã€‚

åœ¨å†™ Hello World ä»£ç æ—¶ï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº†ä»€ä¹ˆå«"ç”Ÿäº§åŠ›"ã€‚STM32 çš„ HAL åº“å‡½æ•°åé€šå¸¸å¾ˆé•¿ï¼ˆæ¯”å¦‚ `HAL_UART_Transmit`ï¼‰ï¼Œåœ¨ç½‘ä¸Šçœ‹æ•™ç¨‹æ—¶ï¼Œå‘ç°åˆ«äººè¿˜åœ¨ä¸€ä¸ªä¸ªå­—æ¯å¯¹ç€æ•²ã€‚

è€Œåœ¨ VS Code é‡Œï¼Œæˆ‘åªéœ€è¦è¾“å…¥ `HAL_UART_Tr`ï¼Œæ™ºèƒ½æç¤ºåˆ—è¡¨ç¬é—´å¼¹å‡ºã€‚æˆ‘çœ‹äº†ä¸€çœ¼ï¼Œæ’ç¬¬ä¸€çš„æ­£æ˜¯ `HAL_UART_Transmit`ï¼Œ**ç›´æ¥æŒ‰ä¸‹ `Tab` é”®**ï¼Œå®ƒä¸ä»…è‡ªåŠ¨è¡¥å…¨äº†å†—é•¿çš„å‡½æ•°åï¼Œç”šè‡³è¿å‚æ•°å ä½ç¬¦éƒ½ç»™æˆ‘å‡†å¤‡å¥½äº†ã€‚

```c
// è¿™ç§é¡ºæ»‘æ„Ÿï¼Œè°ç”¨è°çŸ¥é“
HAL_UART_Transmit(&huart1, (uint8_t *)"Hello, World!\r\n", 15, HAL_MAX_DELAY);
```

ä¸éœ€è¦å®Œæ•´æ‰“å‡ºæ¯ä¸€ä¸ªå­—æ¯ï¼Œä¸éœ€è¦å»ç¿»å¤´æ–‡ä»¶æŸ¥å‚æ•°ã€‚è¿™ç§"æ‰€æƒ³å³æ‰€å¾—"çš„è¡¥å…¨åŠŸèƒ½ï¼Œè®©æˆ‘ç¬¬ä¸€æ¬¡è§‰å¾—å†™ C è¯­è¨€ä¹Ÿèƒ½åƒå†™ Python ä¸€æ ·æµç•…ã€‚ï¼ˆè™½ç„¶æˆ‘åæ¥è¿˜æ˜¯å› ä¸ºå¤ªè‡ªä¿¡æ²¡ç”¨ Tab è€Œç¿»è½¦äº†ï¼Œè§ä¸‹æ–‡ï¼‰ã€‚

## ğŸ› ï¸ æŠ€æœ¯è¿›é˜¶ï¼šä¸­æ–­æ§åˆ¶

è·‘é€š Hello World åï¼Œæˆ‘å†³å®šä»"è‡ªè¨€è‡ªè¯­"å‡çº§ä¸º"ä½ é—®æˆ‘ç­”"ã€‚

1. **æŠ›å¼ƒè½®è¯¢ï¼Œæ‹¥æŠ±ä¸­æ–­ï¼š** ä¸åœ¨ `while(1)` é‡Œå‚»ç­‰æ•°æ®ï¼Œè€Œæ˜¯å¼€å¯ `NVIC` ä¸­æ–­ã€‚
2. **å·¥å…·é“¾åˆ‡æ¢ï¼š** ä»Šå¤©å°è¯•äº†å¦ä¸€ç§çƒ§å½•æ–¹å¼ï¼šä½¿ç”¨ USB-TTL é…åˆ `stm32flash` å·¥å…·è¿›è¡Œ ISP çƒ§å½•ã€‚
3. **è°ƒè¯•ç¥å™¨ï¼š** åœ¨ Linux ç»ˆç«¯ç”¨ `picocom` å……å½“ä¸²å£åŠ©æ‰‹ï¼Œæ¯” Windows ä¸‹çš„ç‚¹ç‚¹ç‚¹å¸…å¤šäº†ã€‚

## ğŸ’£ è¸©å‘ä¸å¡«å‘è®°å½• (Debug Log)

### 1. ç»å…¸çš„"æ‰‹æ»‘"ç°åœº

è™½ç„¶ VS Code æœ‰ Tab è¡¥å…¨ï¼Œä½†æˆ‘æœ‰ä¸€æ¬¡å¤ªè‡ªä¿¡ï¼ŒåšæŒæ‰‹æ‰“ï¼Œç»“æœç¼–è¯‘æŠ¥é”™ `implicit declaration`ã€‚æŸ¥äº†åŠå¤©å‘ç°æŠŠ `HAL_UART_Transmit` å†™æˆäº† `HAL_UARL_Transmit`ï¼ˆ**UART å˜ UARL**ï¼‰ã€‚
*æ•™è®­ï¼šTab é”®è¡¥å…¨æ‰æ˜¯æ°¸è¿œçš„ç¥ï¼Œæ—¢çœåŠ›åˆä¿å‘½ï¼Œä¸è¦ç›²ç›®è‡ªä¿¡æ‰‹æ‰“ã€‚*

### 2. æ¶ˆå¤±çš„"ä¿„ç½—æ–¯å¥—å¨ƒ"æ‹¬å·

åœ¨ä¸ºäº†æµ‹è¯•ä¸­æ–­è€Œåˆ é™¤ `while(1)` é‡Œçš„æ—§ Hello World ä»£ç æ—¶ï¼Œä¸å°å¿ƒæŠŠ `main` å‡½æ•°çš„ç»“æŸå¤§æ‹¬å· `}` ä¹Ÿé¡ºæ‰‹åˆ äº†ã€‚å¯¼è‡´ `make` ç–¯ç‹‚æŠ¥é”™ `invalid storage class`ï¼Œç¼–è¯‘å™¨ä»¥ä¸ºæˆ‘åœ¨ `main` è‚šå­é‡Œå®šä¹‰äº†å…¶ä»–å‡½æ•°ã€‚
*è§£å†³ï¼šç»†å¿ƒæ£€æŸ¥ä»£ç å—ç»“æ„ï¼Œè¡¥ä¸Šä¸¤ä¸ª `}`ï¼Œä¸€ä¸ªç»™ `while`ï¼Œä¸€ä¸ªç»™ `main`ã€‚*

### 3. "æ˜™èŠ±ä¸€ç°"çš„ LED

ä»£ç çƒ§è¿›å»äº†ï¼Œä¸²å£ä¹Ÿèƒ½å›æ˜¾ "LED ON"ï¼Œä½†æ¿å­ä¸Šçš„ç¯åªæ˜¯é—ªä¸€ä¸‹ï¼Œæ­»æ´»ä¸**å¸¸äº®**ã€‚
*æ’æŸ¥ï¼š* å±…ç„¶æ˜¯å› ä¸ºåœ¨ CubeMX é‡Œåªé…äº†ä¸²å£ï¼Œ**å¿˜äº†æŠŠ PC13 å¼•è„šè®¾ä¸º GPIO_Output**ï¼
*åŸç†ï¼š* æ²¡è®¾è¾“å‡ºæ—¶å¼•è„šæ˜¯é«˜é˜»æ€ï¼ˆInputï¼‰ï¼Œæ ¹æœ¬æ²¡åŠ›æ°”æ‹‰ä½ç”µå¹³ç‚¹ç¯ã€‚æ”¹æˆ Output åï¼Œé—®é¢˜ç§’è§£ã€‚

## ğŸ’» æ ¸å¿ƒä»£ç  (Callback å›è°ƒ)

æŠŠé€»è¾‘å†™åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä¸»å¾ªç¯ç©ºè·‘ï¼Œè¿™æ‰æ˜¯åµŒå…¥å¼çš„"ä¼˜é›…"ï¼š

```c
// æ”¾åœ¨ main.c æœ€ä¸‹æ–¹
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
    if(huart->Instance == USART1)
    {
        if(rx_data == '1') {
            HAL_GPIO_WritePin(GPIOC, GPIO_PIN_13, GPIO_PIN_RESET); // äº®ç¯
            HAL_UART_Transmit(&huart1, (uint8_t*)"LED ON\r\n", 8, 100);
        }
        else if(rx_data == '0') {
            HAL_GPIO_WritePin(GPIOC, GPIO_PIN_13, GPIO_PIN_SET);   // ç­ç¯
            HAL_UART_Transmit(&huart1, (uint8_t*)"LED OFF\r\n", 9, 100);
        }
        // å…³é”®ï¼šé‡æ–°å¼€å¯ç›‘å¬ï¼Œä¸ç„¶åªèƒ½å¬ä¸€æ¬¡
        HAL_UART_Receive_IT(&huart1, &rx_data, 1);
    }
}
```

## ğŸ‰ æœ€ç»ˆæˆæœ

åœ¨ç»ˆç«¯æ•²ä¸‹ï¼š

```bash
sudo picocom -b 115200 /dev/ttyUSB0
```

æŒ‰ä¸‹é”®ç›˜ `1`ï¼Œæ¿å­ç¯äº®ï¼›æŒ‰ä¸‹ `0`ï¼Œæ¿å­ç¯ç­ã€‚

**æ„Ÿå—ï¼š** åœ¨ Linux ä¸‹æ•² `make` å’Œ `sudo stm32flash` çš„æ„Ÿè§‰ï¼ŒçœŸçš„æœ‰ç‚¹ä¸Šå¤´ï¼æ˜å¤©è¯•è¯•æŠŠä¹‹å‰çš„ PWM ç»“åˆè¿›æ¥ï¼Œåšä¸ªå¯è°ƒäº®åº¦çš„ç¯ï¼
